{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://example.com/schemas/auth-models.json",
  "title": "User Authentication Data Models",
  "description": "JSON Schema definitions for User and Session entities in the authentication system",
  "definitions": {
    "User": {
      "type": "object",
      "title": "User Entity",
      "description": "Represents a registered user account",
      "required": ["id", "email", "password_hash", "display_name", "created_at"],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "description": "Unique user identifier (UUID v4)",
          "examples": ["123e4567-e89b-12d3-a456-426614174000"]
        },
        "email": {
          "type": "string",
          "format": "email",
          "maxLength": 320,
          "pattern": "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$",
          "description": "User's email address (unique, case-insensitive)",
          "examples": ["user@example.com"]
        },
        "password_hash": {
          "type": "string",
          "minLength": 60,
          "maxLength": 60,
          "pattern": "^\\$2[aby]\\$[0-9]{2}\\$.{53}$",
          "description": "Bcrypt hash of user's password (work factor 12)",
          "examples": ["$2b$12$KIXxKj8N7vaLMx6YPh.a6eW8n3o7y8p5q6r7s8t9u0v1w2x3y4z5a6"]
        },
        "display_name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 100,
          "description": "User's display name (supports Unicode characters)",
          "examples": ["John Doe", "Jane Smith ðŸš€"]
        },
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "Account creation timestamp (ISO 8601, UTC)",
          "examples": ["2026-02-05T12:00:00Z"]
        },
        "last_login_at": {
          "type": ["string", "null"],
          "format": "date-time",
          "description": "Last successful login timestamp (ISO 8601, UTC)",
          "examples": ["2026-02-05T12:30:00Z", null]
        }
      },
      "additionalProperties": false
    },

    "Session": {
      "type": "object",
      "title": "Session Entity",
      "description": "Represents an authenticated user session",
      "required": ["id", "user_id", "token_hash", "created_at", "expires_at", "last_activity_at"],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "description": "Unique session identifier (UUID v4)",
          "examples": ["987e6543-e21b-12d3-a456-426614174000"]
        },
        "user_id": {
          "type": "string",
          "format": "uuid",
          "description": "Foreign key to User.id",
          "examples": ["123e4567-e89b-12d3-a456-426614174000"]
        },
        "token_hash": {
          "type": "string",
          "minLength": 64,
          "maxLength": 64,
          "pattern": "^[a-f0-9]{64}$",
          "description": "SHA-256 hash of JWT token (hex string)",
          "examples": ["a1b2c3d4e5f6789012345678901234567890abcdef0123456789abcdef012345"]
        },
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "Session creation timestamp (ISO 8601, UTC)",
          "examples": ["2026-02-05T12:00:00Z"]
        },
        "expires_at": {
          "type": "string",
          "format": "date-time",
          "description": "Session expiration timestamp (created_at + 30 days, renewable)",
          "examples": ["2026-03-07T12:00:00Z"]
        },
        "last_activity_at": {
          "type": "string",
          "format": "date-time",
          "description": "Last user activity timestamp (updated on each request)",
          "examples": ["2026-02-05T14:30:00Z"]
        },
        "user_agent": {
          "type": ["string", "null"],
          "maxLength": 500,
          "description": "Browser/device user agent string (optional, for audit)",
          "examples": ["Mozilla/5.0 (Windows NT 10.0; Win64; x64)...", null]
        },
        "ip_address": {
          "type": ["string", "null"],
          "maxLength": 45,
          "description": "IPv4 or IPv6 address (optional, for audit)",
          "examples": ["192.168.1.1", "2001:0db8:85a3:0000:0000:8a2e:0370:7334", null]
        }
      },
      "additionalProperties": false
    },

    "SignupRequest": {
      "type": "object",
      "title": "Signup Request",
      "description": "Request payload for user registration",
      "required": ["email", "password", "display_name"],
      "properties": {
        "email": {
          "type": "string",
          "format": "email",
          "maxLength": 320,
          "pattern": "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$",
          "description": "User's email address",
          "examples": ["user@example.com"]
        },
        "password": {
          "type": "string",
          "minLength": 8,
          "description": "Password (min 8 chars, must contain 1 digit and 1 special char)",
          "examples": ["SecureP@ss123"]
        },
        "display_name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 100,
          "description": "User's display name",
          "examples": ["John Doe"]
        }
      },
      "additionalProperties": false
    },

    "LoginRequest": {
      "type": "object",
      "title": "Login Request",
      "description": "Request payload for user authentication",
      "required": ["email", "password"],
      "properties": {
        "email": {
          "type": "string",
          "format": "email",
          "description": "User's email address",
          "examples": ["user@example.com"]
        },
        "password": {
          "type": "string",
          "description": "User's password",
          "examples": ["SecureP@ss123"]
        }
      },
      "additionalProperties": false
    },

    "UpdateProfileRequest": {
      "type": "object",
      "title": "Update Profile Request",
      "description": "Request payload for updating user profile",
      "properties": {
        "display_name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 100,
          "description": "New display name (supports Unicode)",
          "examples": ["Jane Smith", "John Doe ðŸš€"]
        }
      },
      "additionalProperties": false
    },

    "UserResponse": {
      "type": "object",
      "title": "User Response",
      "description": "User data returned by API (excludes password_hash)",
      "required": ["id", "email", "display_name", "created_at", "last_login_at"],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "description": "Unique user identifier",
          "examples": ["123e4567-e89b-12d3-a456-426614174000"]
        },
        "email": {
          "type": "string",
          "format": "email",
          "description": "User's email address",
          "examples": ["user@example.com"]
        },
        "display_name": {
          "type": "string",
          "description": "User's display name",
          "examples": ["John Doe"]
        },
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "Account creation timestamp",
          "examples": ["2026-02-05T12:00:00Z"]
        },
        "last_login_at": {
          "type": ["string", "null"],
          "format": "date-time",
          "description": "Last successful login timestamp",
          "examples": ["2026-02-05T12:30:00Z"]
        }
      },
      "additionalProperties": false
    },

    "ProfileResponse": {
      "type": "object",
      "title": "Profile Response",
      "description": "Extended user profile with additional metadata",
      "allOf": [
        { "$ref": "#/definitions/UserResponse" }
      ],
      "properties": {
        "active_sessions_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of active sessions for this user",
          "examples": [2]
        }
      }
    },

    "ErrorResponse": {
      "type": "object",
      "title": "Error Response",
      "description": "Standard error response format",
      "required": ["error", "message"],
      "properties": {
        "error": {
          "type": "string",
          "description": "Error type (e.g., Validation Error, Unauthorized)",
          "examples": ["Validation Error", "Unauthorized", "Conflict"]
        },
        "message": {
          "type": "string",
          "description": "Human-readable error message",
          "examples": ["Invalid email address format", "Session expired"]
        },
        "details": {
          "type": "array",
          "description": "Detailed validation errors (optional)",
          "items": {
            "type": "object",
            "required": ["field", "message"],
            "properties": {
              "field": {
                "type": "string",
                "description": "Field name that caused the error",
                "examples": ["email", "password", "display_name"]
              },
              "message": {
                "type": "string",
                "description": "Specific error message for this field",
                "examples": ["Must be a valid email address"]
              }
            }
          }
        }
      },
      "additionalProperties": false
    }
  }
}
